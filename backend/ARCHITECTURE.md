# MyDietCoach - Cloud Database Architecture

## ðŸ“Š Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MOBILE APP (iOS/Android)                   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Sign Up    â”‚  â”‚   Track      â”‚  â”‚    View Progress     â”‚ â”‚
â”‚  â”‚   Login      â”‚  â”‚   Water      â”‚  â”‚    Add Meal Plan     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                 â”‚                      â”‚             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                           â”‚                                    â”‚
â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚                â”‚  service/api.ts     â”‚                        â”‚
â”‚                â”‚  (HTTP Client)      â”‚                        â”‚
â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ HTTP/HTTPS
                             â”‚ (axios requests)
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BACKEND SERVER                             â”‚
â”‚                   (Node.js + Express)                           â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    API ENDPOINTS                           â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  /api/users/register    - Create new user                 â”‚ â”‚
â”‚  â”‚  /api/users/login       - Authenticate user               â”‚ â”‚
â”‚  â”‚  /api/users/:userId     - Get/Update user                 â”‚ â”‚
â”‚  â”‚  /api/water/track       - Track water intake              â”‚ â”‚
â”‚  â”‚  /api/water/today/:id   - Get today's water               â”‚ â”‚
â”‚  â”‚  /api/recipes/custom    - Save/Get recipes                â”‚ â”‚
â”‚  â”‚  /api/progress          - Track weight/body metrics       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                      â”‚                                         â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚            â”‚  Express Routes    â”‚                             â”‚
â”‚            â”‚  (server.js)       â”‚                             â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ SQL Queries
                       â”‚ (pg Pool)
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 POSTGRESQL DATABASE                            â”‚
â”‚                    (Cloud Hosted)                              â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   users    â”‚  â”‚   recipes  â”‚  â”‚  water_tracking        â”‚  â”‚
â”‚  â”‚            â”‚  â”‚            â”‚  â”‚                        â”‚  â”‚
â”‚  â”‚  - id      â”‚  â”‚  - id      â”‚  â”‚  - id                  â”‚  â”‚
â”‚  â”‚  - email   â”‚  â”‚  - user_id â”‚  â”‚  - user_id             â”‚  â”‚
â”‚  â”‚  - name    â”‚  â”‚  - name    â”‚  â”‚  - date                â”‚  â”‚
â”‚  â”‚  - weight  â”‚  â”‚  - data    â”‚  â”‚  - water_consumed      â”‚  â”‚
â”‚  â”‚  - goal    â”‚  â”‚            â”‚  â”‚                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ meal_plans â”‚  â”‚  progress_ â”‚  â”‚  scheduled_meals       â”‚  â”‚
â”‚  â”‚            â”‚  â”‚  tracking  â”‚  â”‚                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ”„ Data Flow Examples

### Example 1: User Registration

```
Mobile App                Backend Server           Database
    â”‚                          â”‚                       â”‚
    â”‚  POST /api/users/       â”‚                       â”‚
    â”‚  register               â”‚                       â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
    â”‚  { email, name,         â”‚                       â”‚
    â”‚    password }           â”‚                       â”‚
    â”‚                         â”‚  INSERT INTO users   â”‚
    â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                         â”‚                       â”‚
    â”‚                         â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
    â”‚                         â”‚  User data with ID    â”‚
    â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
    â”‚  { success: true,       â”‚                       â”‚
    â”‚    user: {...} }        â”‚                       â”‚
    â”‚                         â”‚                       â”‚
    â”‚  Store in AsyncStorage  â”‚                       â”‚
    â”‚  for offline access     â”‚                       â”‚
    â”‚                         â”‚                       â”‚
```

### Example 2: Track Water Intake

```
Mobile App                Backend Server           Database
    â”‚                          â”‚                       â”‚
    â”‚  Tap "Add Glass"         â”‚                       â”‚
    â”‚  of Water                â”‚                       â”‚
    â”‚                         â”‚                       â”‚
    â”‚  POST /api/water/       â”‚                       â”‚
    â”‚  track                  â”‚                       â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
    â”‚  { userId: 1,           â”‚                       â”‚
    â”‚    amount: 1,           â”‚  SELECT * FROM       â”‚
    â”‚    goal: 8 }            â”‚  water_tracking      â”‚
    â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                         â”‚  WHERE user_id=1     â”‚
    â”‚                         â”‚  AND date=today      â”‚
    â”‚                         â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
    â”‚                         â”‚                       â”‚
    â”‚                         â”‚  UPDATE water_       â”‚
    â”‚                         â”‚  consumed += 1       â”‚
    â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                         â”‚                       â”‚
    â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
    â”‚  { success: true,       â”‚                       â”‚
    â”‚    tracking: {...} }    â”‚                       â”‚
    â”‚                         â”‚                       â”‚
    â”‚  Update UI to show      â”‚                       â”‚
    â”‚  new water count        â”‚                       â”‚
    â”‚                         â”‚                       â”‚
```

### Example 3: Save Custom Recipe

```
Mobile App                Backend Server           Database
    â”‚                          â”‚                       â”‚
    â”‚  Fill recipe form        â”‚                       â”‚
    â”‚  and submit              â”‚                       â”‚
    â”‚                         â”‚                       â”‚
    â”‚  POST /api/recipes/     â”‚                       â”‚
    â”‚  custom                 â”‚                       â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
    â”‚  { userId: 1,           â”‚                       â”‚
    â”‚    recipeName: "...",   â”‚  INSERT INTO         â”‚
    â”‚    ingredients: [...],  â”‚  recipes             â”‚
    â”‚    instructions: [...] }â”‚  (user_id,           â”‚
    â”‚                         â”‚   recipe_name,        â”‚
    â”‚                         â”‚   json_data)          â”‚
    â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                         â”‚  VALUES (...)         â”‚
    â”‚                         â”‚                       â”‚
    â”‚                         â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
    â”‚                         â”‚  Recipe with ID       â”‚
    â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
    â”‚  { success: true,       â”‚                       â”‚
    â”‚    recipe: {...} }      â”‚                       â”‚
    â”‚                         â”‚                       â”‚
    â”‚  Show success message   â”‚                       â”‚
    â”‚  Add to recipes list    â”‚                       â”‚
    â”‚                         â”‚                       â”‚
```

## ðŸŒ Deployment Options

### Local Development
```
Your Computer
â”œâ”€â”€ Backend Server (localhost:3000)
â”‚   â””â”€â”€ PostgreSQL Database (localhost:5432)
â”‚
â””â”€â”€ Mobile App (iOS Simulator)
    â””â”€â”€ Connects to http://YOUR_IP:3000/api
```

### Production (Cloud Hosted)
```
                    Internet
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                             â”‚
   Mobile Users              Mobile Users
   (iOS/Android)             (iOS/Android)
        â”‚                             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                    HTTPS
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Cloud Server              â”‚
        â”‚   (Heroku/Railway/Render)   â”‚
        â”‚                             â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚  Backend API Server  â”‚   â”‚
        â”‚  â”‚  (Node.js + Express) â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â”‚ PostgreSQL Protocol
                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Cloud Database           â”‚
        â”‚  (PostgreSQL)             â”‚
        â”‚  - Heroku Postgres        â”‚
        â”‚  - Railway Postgres       â”‚
        â”‚  - Render Postgres        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ“± Migration from AsyncStorage to Cloud

### Before (AsyncStorage)
```typescript
// Data stored locally on device
const storage = await AsyncStorage.getItem('mydietcoach_data');
const data = JSON.parse(storage);
```

**Pros:**
- âœ… Works offline
- âœ… No server needed
- âœ… Fast

**Cons:**
- âŒ Data only on one device
- âŒ No backup
- âŒ No sync between devices

### After (Cloud Database)
```typescript
// Data stored on server
const response = await axios.post('/api/users/register', {
  email, name, password
});
const user = response.data.user;
```

**Pros:**
- âœ… Data on all devices
- âœ… Automatic backup
- âœ… Multi-device sync
- âœ… Shareable data
- âœ… Analytics possible

**Cons:**
- âŒ Requires internet
- âŒ Server costs
- âŒ Slightly slower

## ðŸ”„ Hybrid Approach (Best of Both)

```typescript
// Try cloud first
try {
  const data = await api.getUserData(userId);
  // Store locally for offline access
  await AsyncStorage.setItem('cache', JSON.stringify(data));
  return data;
} catch (error) {
  // If offline, use cached data
  const cached = await AsyncStorage.getItem('cache');
  return JSON.parse(cached);
}
```

**Benefits:**
- âœ… Works offline (uses cache)
- âœ… Syncs when online
- âœ… Fast (cached data)
- âœ… Reliable (backup on server)

## ðŸš€ Next Steps

1. âœ… Backend server created
2. âœ… Database schema ready
3. âœ… API endpoints defined
4. âœ… Mobile app client ready
5. â³ Deploy to cloud
6. â³ Test on real devices
7. â³ Add authentication (JWT)
8. â³ Add offline sync
9. â³ Monitor and optimize

## ðŸ“Š Performance Comparison

| Operation          | AsyncStorage | Cloud API  | Hybrid    |
|--------------------|-------------|------------|-----------|
| First Load         | 50ms        | 500ms      | 500ms     |
| Subsequent Load    | 50ms        | 500ms      | 50ms      |
| Save Data          | 100ms       | 600ms      | 150ms     |
| Multi-Device Sync  | âŒ          | âœ…         | âœ…        |
| Offline Access     | âœ…          | âŒ         | âœ…        |
| Data Backup        | âŒ          | âœ…         | âœ…        |
| Scalability        | âŒ          | âœ…         | âœ…        |
